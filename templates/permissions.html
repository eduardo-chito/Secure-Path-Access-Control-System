{% extends "base.html" %}
{% block content %}
<section>
    <h2>Role Management</h2>

    <form method="post" action="/permissions"style="display: grid; grid-template-columns: 1fr 2fr auto; gap: .6rem; align-items: end; max-width: 820px; margin: .5rem 0 1rem; ">
        <input type="hidden" name="action" value="add">
        <div>
            <label>Name</label>
            <input type="text" name="name" required placeholder="e.g. view_logs" style="width: 100%; padding: .55rem;">
        </div>
        <div>
            <label>Description</label>
            <input type="text" name="description" placeholder="What this permission allows" style="width: 100%; padding: .55rem;">
        </div>
        <button class="btn" type="submit">Add Permission</button>
    </form>

    <div style="overflow: auto; margin-bottom: 1.5rem;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr>
                    <th style=" text-align: left; padding: .5rem; border-bottom: 2px solid #004aad;">ID</th>
                    <th style=" text-align: left; padding: .5rem; border-bottom: 2px solid #004aad;">Name</th>
                    <th style=" text-align: left; padding: .5rem; border-bottom: 2px solid #004aad;">Description</th>
                    <th style=" text-align: left; padding: .5rem; border-bottom: 2px solid #004aad;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for perm in permissions %}
                <tr>
                    <td style="padding: .5rem; border-bottom: 1px solid #e5e7eb;">{{ perm.id }}</td>
                    <td style="padding: .5rem; border-bottom: 1px solid #e5e7eb;">{{ perm.name }}</td>
                    <td style="padding: .5rem; border-bottom: 1px solid #e5e7eb;">{{ perm.description }}</td>
                    <td style="padding: .5rem; border-bottom: 1px solid #e5e7eb;">
                        <form method="post" action="/permissions" onsubmit="return confirm('Delete permission {{ perm.name }}?');" style="display: inline;">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="perm_id" value="{{ perm.id }}">
                            <button class="btn" type="submit" style="background: #b91c1c;">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <section>
        <h2>Assign Permission to Role</h2>
        <form method="post" action="/permissions" style="display: grid; grid-template-columns: 1fr 1fr auto; gap: .6rem; align-items: end; max-width: 720px;">
            <input type="hidden" name="action" value="assign" />
            <div>
                <label>Role</label>
                <select name="role_id" required style="width: 100%; padding: .55rem;">
                    {% for role in roles%}
                        <option value="{{ role.id }}">{{ role.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>Permissions</label>
                <select name="perm_id" required style="width: 100%; padding: .55rem;">
                    {% for perm in permissions %}
                        <option value="{{ perm.id }}">{{ perm.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <button class="btn" type="submit">Assign</button>
        </form>
    </section>

    <section>
        <h2>Current Assignments</h2>
        <div style="overflow: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="text-align: left; padding: .5rem; border-bottom: 2px solid #004aad;">Role</th>
                        <th style="text-align: left; padding: .5rem; border-bottom: 2px solid #004aad;">Permission</th>
                    </tr>
                </thead>
                <tbody>
                    {% for rp in role_perms %}
                    <tr>
                        <td style="padding: .5rem; border-bottom: 1px solid #e5e7eb;">{{ rp.role }}</td>
                        <td style="padding: .5rem; border-bottom: 1px solid #e5e7eb;">{{ rp.perm }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</section>
{% endblock %}